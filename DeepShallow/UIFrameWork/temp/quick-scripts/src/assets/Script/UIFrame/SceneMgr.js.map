{"version":3,"sources":["assets/Script/UIFrame/SceneMgr.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,gDAA+C;AAE/C,qCAAgC;AAChC,yCAAoC;AAEpC,IAAM,GAAG,GAAG,UAAU,CAAC;AACvB;IAAA;QACY,YAAO,GAAkB,EAAE,CAAC;QAC5B,eAAU,GAAW,EAAE,CAAC;IAmEpC,CAAC;IAjEU,+BAAY,GAAnB;QACI,OAAO,mBAAS,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IAC5D,CAAC;IAED,aAAa;IACA,uBAAI,GAAjB,UAAkB,SAAiB,EAAE,MAAY,EAAE,QAAoB;;;;;;wBACnE,IAAG,IAAI,CAAC,UAAU,IAAI,SAAS,EAAE;4BAC7B,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE,oBAAoB,CAAC,CAAC;4BACnC,sBAAO,IAAI,EAAC;yBACf;wBAED,qBAAM,IAAI,CAAC,WAAW,CAAC,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,WAAW,EAAE,MAAM,EAAE,QAAQ,CAAC,EAAA;;wBAA/D,SAA+D,CAAC;6BAE7D,CAAA,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAA,EAAvB,wBAAuB;wBAClB,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,GAAC,CAAC,CAAC,CAAC;wBACpD,qBAAM,mBAAS,CAAC,WAAW,EAAE,CAAC,SAAS,CAAC,SAAS,CAAC,EAAA;;wBAAlD,SAAkD,CAAC;;;wBAGnD,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;wBAC1C,IAAG,GAAG,IAAI,CAAC,CAAC,EAAE;4BACV,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;yBAChC;6BAAK;4BACF,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,GAAG,GAAG,CAAC,CAAC;yBACjC;wBAED,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;wBAElB,qBAAM,mBAAS,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,SAAS,EAAE,MAAM,EAAE,QAAQ,CAAC,EAAA;;wBAAzE,GAAG,GAAG,SAAmE;wBAC7E,qBAAM,IAAI,CAAC,YAAY,CAAC,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,WAAW,CAAC,EAAA;;wBAA9C,SAA8C,CAAC;wBAC/C,sBAAO,GAAG,EAAC;;;;KACd;IAED,aAAa;IACA,uBAAI,GAAjB,UAAkB,MAAY,EAAE,QAAoB;;;;;;wBAChD,IAAG,IAAI,CAAC,OAAO,CAAC,MAAM,IAAI,CAAC,EAAE;4BACzB,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE,kBAAkB,CAAC,CAAC;4BACjC,sBAAQ;yBACX;wBACD,qBAAM,IAAI,CAAC,WAAW,CAAC,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,WAAW,EAAE,MAAM,EAAE,QAAQ,CAAC,EAAA;;wBAA/D,SAA+D,CAAC;wBAC5D,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC;wBACnC,qBAAM,mBAAS,CAAC,WAAW,EAAE,CAAC,SAAS,CAAC,SAAS,CAAC,EAAA;;wBAAlD,SAAkD,CAAC;wBAEnD,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,GAAC,CAAC,CAAC,CAAC;wBACtD,qBAAM,mBAAS,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,EAAE,MAAM,EAAE,QAAQ,CAAC,EAAA;;wBAAzE,SAAyE,CAAC;wBAC1E,qBAAM,IAAI,CAAC,YAAY,CAAC,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,WAAW,CAAC,EAAA;;wBAA9C,SAA8C,CAAC;;;;;KAClD;IAEY,wBAAK,GAAlB,UAAmB,SAAiB;;;;gBAC5B,GAAG,GAAG,mBAAS,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;gBACrD,IAAG,GAAG,EAAE;oBACJ,sBAAO,mBAAS,CAAC,WAAW,EAAE,CAAC,SAAS,CAAC,SAAS,CAAC,EAAC;iBACvD;;;;KACJ;IAEa,8BAAW,GAAzB,UAA0B,UAAuB,EAAE,MAAW,EAAE,QAAmB;;;;;;wBAC3E,IAAI,GAAG,UAAU,IAAI,qBAAS,CAAC,kBAAkB,CAAC;wBACtD,IAAG,CAAC,IAAI;4BAAE,sBAAQ;wBAClB,qBAAM,iBAAO,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,MAAM,EAAE,QAAQ,CAAC,EAAA;;wBAApD,SAAoD,CAAC;;;;;KACxD;IACa,+BAAY,GAA1B,UAA2B,UAAuB;;;;;;wBAC1C,IAAI,GAAG,UAAU,IAAI,qBAAS,CAAC,kBAAkB,CAAC;wBACtD,IAAG,CAAC,IAAI;4BAAE,sBAAQ;wBAClB,qBAAM,iBAAO,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,EAAA;;wBAAnC,SAAmC,CAAC;;;;;KACvC;IAEL,eAAC;AAAD,CArEA,AAqEC,IAAA;AAED,kBAAe,IAAI,QAAQ,EAAE,CAAC","file":"","sourceRoot":"/","sourcesContent":["import { SysDefine } from \"./config/SysDefine\";\nimport { IFormConfig, IFormData } from \"./Struct\";\nimport TipsMgr from \"./TipsMgr\";\nimport UIManager from \"./UIManager\";\n\nconst TAG = \"SceneMgr\";\nclass SceneMgr {\n    private _scenes: Array<string> = [];\n    private _currScene: string = \"\";\n\n    public getCurrScene() {\n        return UIManager.getInstance().getForm(this._currScene);\n    }\n\n    /** 打开一个场景 */\n    public async open(scenePath: string, params?: any, formData?: IFormData) {\n        if(this._currScene == scenePath) {\n            cc.warn(TAG, \"当前场景和需要open的场景是同一个\");\n            return null;\n        }\n\n        await this.openLoading(formData?.loadingForm, params, formData);\n\n        if(this._scenes.length > 0) {\n            let currScene = this._scenes[this._scenes.length-1];\n            await UIManager.getInstance().closeForm(currScene);\n        }\n\n        let idx = this._scenes.indexOf(scenePath);\n        if(idx == -1) {\n            this._scenes.push(scenePath);\n        }else {\n            this._scenes.length = idx + 1;\n        }\n\n        this._currScene = scenePath;\n\n        let com = await UIManager.getInstance().openForm(scenePath, params, formData);\n        await this.closeLoading(formData?.loadingForm);\n        return com;\n    }\n\n    /** 回退一个场景 */\n    public async back(params?: any, formData?: IFormData) {\n        if(this._scenes.length <= 1) {\n            cc.warn(TAG, \"已经是最后一个场景了, 无处可退\");\n            return ;\n        }\n        await this.openLoading(formData?.loadingForm, params, formData);\n        let currScene = this._scenes.pop();\n        await UIManager.getInstance().closeForm(currScene);\n\n        this._currScene = this._scenes[this._scenes.length-1];\n        await UIManager.getInstance().openForm(this._currScene, params, formData);\n        await this.closeLoading(formData?.loadingForm);\n    }\n\n    public async close(scenePath: string) {\n        let com = UIManager.getInstance().getForm(scenePath);\n        if(com) {\n            return UIManager.getInstance().closeForm(scenePath);\n        }\n    }\n\n    private async openLoading(formConfig: IFormConfig, params: any, formData: IFormData) {\n        let form = formConfig || SysDefine.defaultLoadingForm;\n        if(!form) return ;\n        await TipsMgr.open(form.prefabUrl, params, formData);\n    }\n    private async closeLoading(formConfig: IFormConfig) {\n        let form = formConfig || SysDefine.defaultLoadingForm;\n        if(!form) return ;\n        await TipsMgr.close(form.prefabUrl);\n    }\n\n}\n\nexport default new SceneMgr();"]}