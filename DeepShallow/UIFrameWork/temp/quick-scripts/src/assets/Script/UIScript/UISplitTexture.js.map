{"version":3,"sources":["assets/Script/UIScript/UISplitTexture.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import TexturePlus from \"../Common/Components/TexturePlus\";\nimport { PolygonUtil } from \"../Common/Utils/PolygonUtil\";\nimport { UIScreen } from \"../UIFrame/UIForm\";\nimport UISplitTexture_Auto from \"../AutoScripts/UISplitTexture_Auto\";\nimport FormMgr from \"../UIFrame/FormMgr\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class UISplitTexture extends UIScreen {\n\n\n    @property(cc.Node)\n    textureRoot: cc.Node = null;\n    @property(cc.Graphics)\n    graphics: cc.Graphics = null;\n    @property(cc.Texture2D)\n    pic: cc.Texture2D = null;\n\n    private textures: TexturePlus[] = [];\n    private startPoint: cc.Vec2 = null;\n    private endPoint: cc.Vec2 = null;\n\n    view: UISplitTexture_Auto;\n\n    start() {\n        this.init();\n\n        this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\n\n        this.graphics.node.x = -cc.visibleRect.width/2;\n        this.graphics.node.y = -cc.visibleRect.height/2;\n\n        this.view.Close.addClick(() => {\n            FormMgr.backScene();\n        }, this);\n    }\n\n    init() {\n        let node = new cc.Node();\n        let t = node.addComponent(TexturePlus);\n        node.parent = this.textureRoot;\n        t.texture = this.pic;\n        this.textures.push(t);\n    }\n    onTouchStart(e: cc.Event.EventTouch) {\n        this.startPoint = e.getLocation();\n    }\n    onTouchMove(e: cc.Event.EventTouch) {\n        this.graphics.clear();\n        this.graphics.moveTo(this.startPoint.x, this.startPoint.y);\n        let p = e.getLocation();\n        this.graphics.lineTo(p.x, p.y);\n        this.graphics.stroke();\n    }\n    onTouchEnd(e: cc.Event.EventTouch) {\n        this.graphics.clear();\n        this.endPoint = e.getLocation();\n        this.useLineCutPolygon(this.startPoint, this.endPoint);\n    }\n\n    private doSplit() {\n        let h = this.pic.height, w = this.pic.width;\n        for(let i=0; i<15; i++) {\n            let p0 = cc.v2(-(w/2+10), (Math.random() * h)-h/2);\n            let p1 = cc.v2(w/2+10, (Math.random() * h)-h/2);\n            this.useLineCutPolygon(p0, p1, false);\n        }\n\n        for(let i=0; i<15; i++) {\n            let p0 = cc.v2(Math.random() * w - w/2, -(h/2+10));\n            let p1 = cc.v2(Math.random() * w - w/2, (h/2+10));\n            this.useLineCutPolygon(p0, p1, false);\n        }\n    }\n\n    private useLineCutPolygon(p0: cc.Vec2, p1: cc.Vec2, isWorld = true) {\n        for(let i=this.textures.length-1; i>=0; i--) {\n            let texture = this.textures[i];\n            let pa = p0.clone();\n            let pb = p1.clone();\n            if(isWorld) {\n                pa = texture.node.convertToNodeSpaceAR(p0);\n                pb = texture.node.convertToNodeSpaceAR(p1);\n            }\n            let polygons = PolygonUtil.lineCutPolygon(pa, pb, texture.polygon);\n            if(polygons.length <= 0) continue;\n            this.splitTexture(texture, polygons);\n        }\n    }\n\n    private splitTexture(texture: TexturePlus, polygons: cc.Vec2[][]) {\n        texture.polygon = polygons[0];\n        for(let i=1; i<polygons.length; i++) {\n            let node = new cc.Node();\n            let t = node.addComponent(TexturePlus);\n            node.parent = this.textureRoot;\n            node.setPosition(texture.node.position);\n            t.texture = this.pic;\n            t.polygon = polygons[i];\n            this.textures.push(t);\n        }\n    }\n\n    onClickFly() {\n        for(let i=0; i<this.textures.length; i++) {\n            let center = this.getPolygonCenter(this.textures[i].polygon);\n            let dir = center.normalize();\n            cc.tween(this.textures[i].node).by(5, {x: dir.x * 500, y: dir.y * 500}).start();\n        }\n    }\n\n    onClickReset() {\n        for(let i=0; i<this.textures.length; i++) {\n            let center = this.getPolygonCenter(this.textures[i].polygon);\n            let dir = center.normalize();\n            cc.tween(this.textures[i].node).by(5, {x: -dir.x * 500, y: -dir.y * 500}).call(() => {\n                if(i === this.textures.length-1) {\n                    this.textureRoot.destroyAllChildren();\n                    this.textureRoot.removeAllChildren();\n                    this.textures = [];\n                    this.init();\n                }\n            }).start();\n        }   \n    }\n\n    onFallDown() {\n        for(let i=0; i<this.textures.length; i++) {\n            let center = this.getPolygonCenter(this.textures[i].polygon);\n            cc.tween(this.textures[i].node).delay((center.y + this.pic.height)/this.pic.height).by(2, {y: -500}, cc.easeCircleActionIn()).start();\n        }\n    }\n    onResetFallDown() {\n        \n    }\n\n    private getPolygonCenter(polygon: cc.Vec2[]) {\n        let x = 0, y = 0;\n        for(let i=0; i<polygon.length; i++) {\n            x += polygon[i].x;\n            y += polygon[i].y;\n        }\n        x = x/polygon.length;\n        y = y/polygon.length;\n        return cc.v2(x, y)\n    }\n}\n"]}