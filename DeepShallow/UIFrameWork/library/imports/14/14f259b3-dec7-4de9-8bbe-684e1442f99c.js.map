{"version":3,"sources":["assets/Script/UIFrame/WindowMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import PriorityQueue from \"../Common/Utils/PriorityQueue\";\nimport PriorityStack from \"../Common/Utils/PriorityStack\";\nimport { EPriority, IFormData } from \"./Struct\";\nimport UIManager from \"./UIManager\";\n\nclass WindowMgr {\n    // 窗体\n    private _showingList: PriorityStack<string> = new PriorityStack();\n    private _waitingList: PriorityQueue<WindowData> = new PriorityQueue();\n    \n    private _currWindow: string = \"\";\n    public get currWindow() {\n        return this._currWindow;\n    }\n\n    public getWindows() {\n        return this._showingList.getElements();\n    }\n\n    /** 打开窗体 */\n    public async open(prefabPath: string, params?: any, formData?: IFormData) {\n        formData = this._formatFormData(formData);\n        if(this._showingList.size <= 0 || (!formData.showWait && formData.priority >= this._showingList.getTopEPriority())) {\n            this._showingList.push(prefabPath, formData.priority);\n            this._currWindow = this._showingList.getTopElement();\n            return await UIManager.getInstance().openForm(prefabPath, params, formData);\n        }\n        \n        // 入等待队列\n        this._waitingList.enqueue({prefabPath: prefabPath, params: params, formData: formData});\n        // 加载窗体\n        return await UIManager.getInstance().loadUIForm(prefabPath);\n    }\n\n    public async close(prefabPath: string) {\n        let result = this._showingList.remove(prefabPath);\n        if(!result) return false;\n\n        await UIManager.getInstance().closeForm(prefabPath);\n\n        if(this._showingList.size <= 0 && this._waitingList.size > 0) {\n            let windowData = this._waitingList.dequeue();\n            this.open(windowData.prefabPath, windowData.params, windowData.formData);\n        }\n        return true;\n    }\n\n    /** 关闭所有弹窗 */\n    public async closeAll() {\n        this._waitingList.clear();\n\n        for(const fid of this._showingList.getElements()) {\n            await UIManager.getInstance().closeForm(fid);\n        }\n        this._showingList.clear();\n        \n        return true;\n    }\n\n    private _formatFormData(formData: any) {\n        return Object.assign({showWait: false, priority: EPriority.FIVE}, formData);\n    }\n}\n\nclass WindowData {\n    prefabPath: string;\n    params?: any;\n    formData?: any;\n}\n\nexport default new WindowMgr();\n"]}