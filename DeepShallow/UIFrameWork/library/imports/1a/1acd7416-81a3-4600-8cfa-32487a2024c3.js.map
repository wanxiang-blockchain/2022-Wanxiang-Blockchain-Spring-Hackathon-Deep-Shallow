{"version":3,"sources":["assets/Script/Common/Components/MeshTexture.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ScrollAssembler from \"../Assemblers/MeshAssembler\";\n\nconst {ccclass, menu, executeInEditMode, mixins, property} = cc._decorator;\n\n@ccclass\n@executeInEditMode\n@menu('i18n:MAIN_MENU.component.ui/MeshTexture')\n@mixins(cc.BlendFunc)\nexport default class MeshTexture extends cc.RenderComponent {\n\n    @property(cc.Texture2D)\n    _texture: cc.Texture2D = null;\n    @property(cc.Texture2D)\n    get texture() {\n        return this._texture;\n    }\n    set texture(val: cc.Texture2D) {\n        this._texture = val;\n        this.node.width = val.width; this.node.height = val.height;\n        this._updateMaterial();\n    }\n\n    @property({displayName: \"步长\"})\n    step = 10;\n\n    @property({type: cc.Enum(cc.macro.BlendFactor), override: true})\n    srcBlendFactor: cc.macro.BlendFactor = cc.macro.BlendFactor.SRC_ALPHA;\n\n    @property({type: cc.Enum(cc.macro.BlendFactor), override: true})\n    dstBlendFactor: cc.macro.BlendFactor = cc.macro.BlendFactor.ONE_MINUS_SRC_ALPHA;\n\n    private _updateVerts() {\n        this.setVertsDirty();\n    }\n\n    public _updateMaterial() {\n        let texture = this._texture;\n        let material = this.getMaterial(0);\n        if(material) {\n            if(material.getDefine(\"USE_TEXTURE\") !== undefined) {\n                material.define(\"USE_TEXTURE\", true);\n            }\n            material.setProperty(\"texture\", texture);\n        }\n        this['__proto__']._updateBlendFunc.call(this);\n        this.setVertsDirty();        \n    }\n\n    public _validateRender() {\n        \n    }\n\n    public _assembler: ScrollAssembler = null;\n    public _resetAssembler() {\n        let assembler = this._assembler = window[\"textureAssember\"] = new ScrollAssembler();\n        assembler.init(this);\n        this._updateColor();\n        this.setVertsDirty();\n    }\n\n\n    private getPolygonCenter(polygon: cc.Vec2[]) {\n        let x = 0, y = 0;\n        for(let i=0; i<polygon.length; i++) {\n            x += polygon[i].x;\n            y += polygon[i].y;\n        }\n        x = x/polygon.length;\n        y = y/polygon.length;\n        return cc.v2(x, y)\n    }\n\n    public tweenVec2(from: cc.Vec2, to: cc.Vec2, duration: number, onUpdate: (t: cc.Vec2) => void, onComplete?: Function, delay: number = 0) {\n        let o: Record<string, cc.Vec2> = {_value: from};\n        Object.defineProperty(o, 'position', {\n            get: () => o._value,\n            set: (v: cc.Vec2) => { o._value = v; onUpdate && onUpdate(o._value); },\n        });\n        let tween = cc.tween(o).delay(delay).to(duration, { position: to }).call(onComplete);\n        tween.start();\n        return tween;\n    }\n\n    public tweenVec2Bezier(from: cc.Vec2, to: cc.Vec2, duration: number, onUpdate: (t: cc.Vec2) => void, onComplete?: Function, delay: number = 0) {\n        let o: Record<string, cc.Vec2> = {_value: from};\n        Object.defineProperty(o, 'position', {\n            get: () => o._value,\n            set: (v: cc.Vec2) => { o._value = v; onUpdate && onUpdate(o._value); },\n        });\n        // let tween = cc.tween(o).delay(delay).to(duration, { position: to }).call(onComplete);\n        let tween = cc.tween(o).delay(delay).bezierTo(duration, cc.v2(from.x, from.y+100), cc.v2(to.x, to.y + 100), to).call(onComplete);\n        tween.start();\n        return tween;\n    }\n\n    public doScaleEffect() {\n        return new Promise((resolve, reject) => {\n            let rectCount = this._assembler.getRectCount();\n            let pos = this.node.convertToWorldSpaceAR(cc.v2(0, 0));\n    \n            for(let i=0; i<rectCount; i++) {\n                let arr = this._assembler.getRect(i);\n    \n                let center = this.getPolygonCenter(arr);\n                let dir = center.sub(pos).normalize();\n    \n                this.tweenVec2(cc.v2(0, 0), dir.mul(1.5), 0.3, (dt: cc.Vec2) => {\n                    this._assembler.setRect(i, [\n                        arr[0].addSelf(dt),\n                        arr[1].addSelf(dt),\n                        arr[2].addSelf(dt),\n                        arr[3].addSelf(dt)\n                    ]);\n                }, () => {\n                    if(i == rectCount-1) resolve(true);\n                });\n            }\n        })\n        \n    }\n\n    public async doTextureMove(e, data) {\n        let dir = cc.v2(-1, 0);\n        if(data == 'right') {\n            dir = cc.v2(1, 0)\n        }\n        \n        let rectCount = this._assembler.getRectCount();\n        let pos = this.node.convertToWorldSpaceAR(cc.v2(0, 0));\n\n        for(let i=0; i<rectCount; i++) {\n            let idx = rectCount - i -1;\n            let arr = this._assembler.getRect(idx);\n\n            let targetPos = dir.mul(400);\n            this.tweenVec2Bezier(cc.v2(0, 0), targetPos, 1, (dt: cc.Vec2) => {\n                this._assembler.setRect(idx, [\n                    arr[0].add(dt),\n                    arr[1].add(dt),\n                    arr[2].add(dt),\n                    arr[3].add(dt),\n                ]);\n            }, () => {\n                this._assembler.setRect(idx, [\n                    arr[0].add(targetPos),\n                    arr[1].add(targetPos),\n                    arr[2].add(targetPos),\n                    arr[3].add(targetPos),\n                ]);\n            }, Math.floor(i/40) * 0.1);\n        }\n    }\n\n}\n\n"]}