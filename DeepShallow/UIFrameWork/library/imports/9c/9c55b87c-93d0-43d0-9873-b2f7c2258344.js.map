{"version":3,"sources":["assets/Script/Common/Components/PropController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import PropSelector, { PropEmum } from \"./PropSelector\";\n\nexport enum NodePathType {\n    Name,\n    SiblingIndex,\n}\ncc['NodePathType'] = NodePathType;\n\nconst {ccclass, executeInEditMode, menu, inspector, property} = cc._decorator;\n\n@ccclass\n@executeInEditMode\n@menu('i18n:状态控制/PropController')\n@inspector('packages://propcontroller/dist/inspector.js')\nexport default class PropController extends cc.Component {\n\n    @property({type: cc.Enum(NodePathType), tooltip: \"Name: 根据node name保存, SiblingIndex: 根据node 在children的index保存\"})\n    nodePathType = NodePathType.SiblingIndex;\n\n    @property({tooltip: \"是否启用控制器\"})\n    open = true;\n    \n    @property({serializable: true})\n    _uid = \"\";\n    @property\n    get uid() {\n        return this._uid;\n    }\n    set uid(val: string) {\n        this._uid = val;\n        this._refreshIdEnum();\n    }\n    \n    @property({type: cc.Enum({})})\n    _state = 0;\n    @property({type: cc.Enum({})})\n    get state() {\n        return this._state;\n    }\n    set state(val: number) {\n        this._state = val;\n        this.doControl(val);\n    }\n\n    @property\n    _states: string[] = [];\n    @property([cc.String])\n    get states() {\n        return this._states;\n    }\n    set states(states: string[]) {\n        this._states = states;\n        this._refresh();\n    }\n\n    @property()\n    propertyJson = '';\n\n    onLoad () {\n        this._refresh();\n        this._refreshIdEnum();\n    }\n\n    start () {}\n\n    public doControl(type: string | number) {\n        let t = type;\n        let ctrl = JSON.parse(this.propertyJson);\n\n        let map = ctrl[t];      \n        for(const path in map) {\n            let paths = path.split(\":\");\n            let node: cc.Node = null;\n            switch(+paths[0]) {\n                case NodePathType.Name:\n                    node = cc.find(paths[1], this.node);\n                    break;\n                case NodePathType.SiblingIndex:\n                    node = this._getNodeBySiblingIndex(paths[1], this.node);\n                    break;\n            }\n            if(!node) { cc.warn(\"find node faild, path:\", path); continue;}\n            let nodeProps = map[path];\n            for(const key in nodeProps) {  \n                let func = _localSetFunc[key];\n                if(!func) continue;\n                func(node, nodeProps[key])\n            }\n        }\n    }\n\n    private _getNodeBySiblingIndex(path: string, node: cc.Node) {\n        path = (path[0] == '/') ? path.substring(1) : path;\n        for(const e of path.split(\"/\")) {\n            node = node.children[+e];\n        }\n        return node;\n    }\n\n    private _refresh() {\n        if(CC_EDITOR) {\n            let array = this._states.map((val, i) => {\n                return {name: val, value: i};\n            });\n            //@ts-ignore\n            cc.Class.Attr.setClassAttr(this, 'state', 'enumList', array);\n            //@ts-ignore\n            // Editor.Utils.refreshSelectedInspector('node', this.node.uuid);\n        }\n    }\n\n    private _refreshIdEnum() {\n        if(CC_EDITOR) {\n            let coms = this.node.getComponents(PropController);\n            let array = coms.map((val, i) => { \n                return {name: val.uid, value: i};\n            });\n            //@ts-ignore\n            cc.Class.Attr.setClassAttr(PropSelector, 'ctrlId', 'enumList', array);\n        }\n    }\n\n\n    \n\n    // update (dt) {}\n}\n\nfunction _setPosition(node: cc.Node, prop: any) {\n    node.setPosition(prop);\n}\nfunction _setColor(node: cc.Node, prop: any) {\n    node.color = new cc.Color(prop.r, prop.g, prop.b);\n}\nfunction _setSacle(node: cc.Node, prop: any) {\n    node.scaleX = prop.scaleX;\n    node.scaleY = prop.scaleY;\n}\nfunction _setRotation(node: cc.Node, prop: any) {\n    node.angle = prop;\n}\nfunction _setOpacity(node: cc.Node, prop: any) {\n    node.opacity = prop;\n}\nfunction _setSlew(node: cc.Node, prop: any) {\n    node.skewX = prop.skewX;\n    node.skewY = prop.skewY;\n}\nfunction _setSize(node: cc.Node, prop: any) {\n    node.setContentSize(prop);\n}\nfunction _setAnchor(node: cc.Node, prop: any) {\n    node.anchorX = prop.anchorX;\n    node.anchorY = prop.anchorY;\n}\nfunction _setActive(node: cc.Node, prop: any) {\n    node.active = prop;\n}\nfunction _setLabelString(node: cc.Node, prop: any) {\n    node.getComponent(cc.Label).string = prop;\n}\nfunction _setSpriteTexture(node: cc.Node, prop: any) {\n    cc.assetManager.loadAny({uuid: prop}, (error, data) => {        \n        if(error) {\n            Editor.warn('PropController  load sprite texture faild', prop, error);\n            return ;\n        };\n        node.getComponent(cc.Sprite).spriteFrame = data;\n    });\n}\n\nconst _localSetFunc: {[key: number]: (node: cc.Node, prop: any) => void} = {};\nfunction _regiestSetFunction(id: number, func: (node: cc.Node, prop: any) => void) {\n    if(_localSetFunc[id]) {\n        cc.warn(\"\");\n    }\n    _localSetFunc[id] = func;\n}\n\n_regiestSetFunction(PropEmum.Active, _setActive);\n_regiestSetFunction(PropEmum.Position, _setPosition);\n_regiestSetFunction(PropEmum.Color, _setColor);\n_regiestSetFunction(PropEmum.Scale, _setSacle);\n_regiestSetFunction(PropEmum.Rotation, _setRotation);\n_regiestSetFunction(PropEmum.Opacity, _setOpacity);\n_regiestSetFunction(PropEmum.Slew, _setSlew);\n_regiestSetFunction(PropEmum.Size, _setSize);\n_regiestSetFunction(PropEmum.Anchor, _setAnchor);\n_regiestSetFunction(PropEmum.Label_String, _setLabelString);\n_regiestSetFunction(PropEmum.Sprite_Texture, _setSpriteTexture);\n"]}